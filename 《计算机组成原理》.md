# 一、计算机系统概述

## I. 概述

### 1. 硬件发展

| 硬件技术         | 特点                                   |
| ---------------- | -------------------------------------- |
| 电子管           | 使用机器语言编程，体积庞大，运算速度慢 |
| 晶体管           | 开始使用高级语言（如FORTRAN）          |
| 中小规模集成电路 | 高级语言和操作系统迅速发展             |
| 超大规模集成电路 | 现代计算机                             |

### 2. 冯诺依曼机

特点：

(1) 由运算器、存储器、控制器、输入设备、输出设备5大模块组成；

(2) 指令和数据共同存储与存储器中，可以按地址访问；

(3) 使用二进制代码（物理元件性质所决定）；

(4) 指令按顺序存放；

(5) 使用控制流驱动方式。

### 3. 计算机语言

​             (编译)            (汇编)            (链接)

高级语言 ---> 汇编语言 ---> 机器语言 ---> 可执行程序

​     						(翻译)

**编译程序**：经过编译等步骤生成计算机可执行程序；

**解释程序**：再运行时才由解释器逐语句去执行；

### 4. 性能指标

（1）机器字长

​		指计算机进行一次整数运算所能处理的二进制数据的位数，如x86和x64；

（2）数据通路带宽

​		指数据总线并行传输的信息的位数；

（3）内存容量

​		指主存储器所能存储信息的容量；

​		CPU中的**内存地址寄存器MAR**和**内存数据寄存器MDR**决定了最大可接受的内存大小：

​		如MAR为16，MDR为32，则最大可寻址的内存为$2^{16} = 65536B = 64KB,64KB * 32=2GB$；

（4）运算速度

​		① 吞吐量

​			指系统在单位时间内能够处理的请求数量；

​		② 响应时间

​			指从请求发出到收到响应所需的时间，响应时间 = CPU执行时间 + 等待时间（IO、OS开销等）；

​		③ CPU主频

​			主频越高，完成一个指令的时间越短，通常以HZ为单位；

​		④ CPU时钟周期

​			为主频的倒数，表示CPU中的单位时间；

​		⑤ CPI

​			指CPU执行一条指令所需要的CPU时钟周期数；

​		⑥ CPU执行时间

​			CPU执行时间 = (指令数 * CPI) / 主频；



# 二、数据的表示和运算

## I. 进制与编码

### 1. 进制转换

**二进制转八进制和十六进制**

```c++
二进制数以小数点为分隔点，
转为八进制，则分为3个一组；
转为十六进制，则分为4个一组；
整数部分开头不够可补0，小数部分末尾不够可补0。

如将二进制数1111000010.01101转为八进制：
	001 111 000 010 . 011 010 -> 1702.32
	
如将二进制数1111000010.01101转为十六进制：
	0011 1100 0010 . 0110 1000 -> 3C2.68
```

**十进制转二进制**

```c++
整数部分持续除以2取余直到0，小数部分持续乘以2取整直到1；

如将十进制数123.6875转为二进制；
	整数部分
		123 / 2  = 61 ... 1 -> 1
		61 / 2 = 30 ... 1   -> 1
		30 / 2 = 15 ... 0   -> 0
		15 / 2 = 7 ... 1    -> 1
		7 / 2 = 3 ... 1     -> 1
		3 / 2 = 1 ... 1     -> 1
		1 / 2 = 0 ... 1     -> 1
		整数部分为1111011；
	小数部分
		0.6875 * 2 = 1.375 ... 1 -> 1
		0.375 * 2 = 0.75 ... 0   -> 0
		0.75 * 2 = 1.5 ... 1     -> 1
		0.5 * 2 = 1 ... 1        -> 1
		小数部分为1011
	结果为1111011.1011
```

### 2. 数据表示法

**原码，反码与补码**

对于正数，其原码 = 补码 = 反码；

对于负数，反码为原码按位取反，补码为反码 + 1；

**BCD码**

使用4个二进制数来表示一个十进制数，方便二进制与十进制间的快速转换；

（1）8421码

​	8,4,2,1分别表示为1000,0100,0010,0001；

​	8421码中，1010(即10)到1111(即15)为无效码，当运算结果位于该区间时，需加上0110(即6，表示6个无效码)，并向高位进1，从而得到正确的结果；

```c++
例如使用8421吗求5 + 9的结果：
	0101 
     + 1001 
     = 1110
     
         1110
     +  0110
     =10100  = 0001 0100 = 14
```

（2）余三码

​	8421码的基础上，每个数都+3，得到余三码；

​	余三码表示的十进制的0和9，1和8，2和7等互为反码，方便进行运算；

（3）2421码

​	2421码的权值分别为2,4,2,1，其大于5的数最高位为1，小于5的数最高位为0；

​	其同样可以实现对9的互补，方便进行运算；

### 3. 字符编码

​	**ASCII码**

​	其只能表示英文字母；

​	**GBK与GBK2312**

​	GBK用于表示汉字，GBK2312为进一步的拓展；

​	**Unicode和UTF-8**

​	目前主流，能表示大多数国家的字符；

### 4. 校验码

#### (1) 奇偶校验码

​	在原编码上加一个检验位，能够检查出奇数个位发生的错误，但不能检查出偶数个位发生的错误，而且也无法确定错误的位置；

​	**奇校验码**：整个校验码中“1”的个数为奇数个；

​	**偶校验码**：整个校验码中“1”的个数为偶数个；

```c++
如求编码1001101的奇校验码和偶校验码：
	奇：1 1001101 -> 1的个数为奇数
	偶：0 1001101 -> 1的个数为偶数
    此时，原始编码1001101因传输问题发生错误：
        错1位：1101101 -> 能检查到错误
        错2位：1111101 -> 检查不到错误
        错3位：0111101 -> 能检查到错误
```

​	奇偶校验码最常见应用于ASCII码，其最高位为校验位，剩下7位为有效位；

#### (2) 海明（汉明）校验码

​	在有效信息中加入几个校验位形成海明码，并把海明码的每个二进制位分配到多个奇偶校验组中；

​	当某一位出错后，就会引起相关的其他校验位的变化，因此可以定位出错的位置；

​	**①校验码的个数**：

​	假如有效数据有m个，校验码有n个，则n个校验码最多能表示$2^n$个出错状态，其中还需要一种状态来表示无错误，因此若想能够找到每个错误的位置，则必需$2^n \geqslant m + n + 1$；

​	**②校验码放置的位置**：

​	如果粗暴的将3个校验码放在最后，将4个有效数据放在最前，则当传输1111时；

​	此时发生一位错误，传输为0111，因此校验位检测到第四位出错，变为001，接收到0010111，则有两种可能，①数据位的第四位发生错误，②校验码的第一位发生了错误，产生了歧义；

​	通过将校验码放在其自身出错时表示的位置，来消除这个歧义；

​	如有3个校验码，其出错时分别为100,010,001，则将这三个校验码分别放置于第1,2,4个位置；

​	同理，后续放置位置分别为8,16,2......

​	**③奇偶校验分组**

​	假如有有效数据1010($D_4D_3D_2D_1$)，有检验位3个，则组成的编码为101X0XX；

​	第一个位置，为0001，

​	第二个位置，为0010，

​	第三个位置，为0011，

​	第四个位置，为0100，

​	第五个位置，为0101，

​	第六个位置，为0110，

​	第七个位置，为0111，

​	其中，凡是XXX1格式的，归到P1组；凡是XX1X格式的，归到P2组...依次类推：

​	P1组：①，③，⑤，⑦，即$0 \oplus 1 \oplus 1 = 0 $

​	P2组：②，③，⑥，⑦，即$0 \oplus 0 \oplus 1 = 1 $

​	P3组：④，⑤，⑥，⑦，即$1 \oplus 0 \oplus 1 = 0 $

​	P4组：无；

​	**④校验位取值**

​	根据分组可得，P1 = 0，P2 = 1，P3 = 0，

​	因此101X0XX为1010010；

​	**⑤进行海明校验**

​	 $S_1 = P1 \oplus \ D_1 \oplus D_2 \oplus D_4 $

​	$S_2 = P2 \oplus \ D_1 \oplus D_3 \oplus D_4 $

​	 $S_3 = P3 \oplus \ D_2 \oplus D_3 \oplus D_4 $

​	当$S_3S_2S_1=000$时表示无错误，否则其表示的值即为出错的数据位的位置，将其取反即可；

#### (3) 循环冗余校验码

在发送端，将K位的信息左移R位，将它与多项式G(x)进行模二除法，得到R位检验码，拼接为K+R位的数据进行发送；

在接收端，利用多项式G(x)对接收到的数据进行模二除法，检测出错的位置，若整除则说明无错；

发送端与接收端约定一个多项式G(x)，其最高次幂为R，使用系数进行表示，如$x^3 + x^2 + 1$表示$1101$；

**①移位**

将原数据左移R位，低位补0；

**②模二除法**

模二除法与算术除法类似，但每一步除的结果不进行借位；

**③检错和纠错**

接收端接收到的信息，与多项式进行模二除法，若余数为0，则无错；若不为0，则纠正对应位。

## II. 定点数的表示

|         | 原码      | 反码      | 补码      | 移码            |
| ------- | --------- | --------- | --------- | --------------- |
| 0.1101  | 0.1101000 | 0.1101000 | 0.1101000 | /               |
| -0.1101 | 1.1101000 | 1.0010111 | 1.0011000 | /               |
| 1101    | 00001101  | 00001101  | 00001101  | $2^7$+00001101  |
| -1101   | 10001101  | 11110010  | 11110011  | $2^7$- 00001101 |

# 三、存储系统

## I. 存储器的层次结构

### 1. 分类

按层次分类：

​	（1）主存储器：即内存；

​	（2）辅助存储器：即硬盘；

​	（3）高速缓冲存储器：即Cache，位于内存和CPU之间；

按存储介质分类：

​	（1）磁表面存储器：如磁盘，磁带；

​	（2）磁芯存储器；

​	（3）半导体存储器；

​	（4）光存储器：光盘；

按存储方式：

​	（1）随机存储器RAM

​		存储器内的任何一个单元都可以随机存取；

​		读写方便，灵活；

​		分为

​			①静态SRAM：只要有供电，数据就不会丢失，速度快，造价高，常用于cache；

​			②动态DRAM：有供电，还需要不断刷新，才能不丢失数据，密度高，常用于内存条；

​			③同步SYNC-DRAM：即SDRAM，相比DRAM增加了时钟信号和内存命令的概念；

​			④双倍速率DDR-SDRAM：可以在一个时钟周期内传输更多的数据；

​			⑤显存GDDR：即专门用于显卡内的Graphics-DDR；

​	（2）只读存储器ROM

​		只能随机读不能写入；

​		即使断电，数据也不会丢失，常用于数据的固化；

​		广义的ROM可以通过电擦除等方式进行写入，但其写入速度仍然远低于读取速度；

​	（3）串行访问存储器

​		进行读写操作时，需要按其物理地址的先后顺序寻址；

按可保存性分类：

​	（1）易失性存储器：如RAM；

​	（2）非易失性存储器：如ROM、磁表面存储器、光存储器；

### 2. 性能指标

（1）存储容量

​	存储容量 = 地址空间大小 * 字长；

（2）单位成本

​	单位成本 = 总成本 / 容量；

（3）存储速度

​	存储速度 = 数据宽度 / 存储周期；

​	存取时间 = 完成一次读写操作的时间；

​	存储周期 = 存储时间 + 两次存取过程之间恢复物理状态的时间；

### 3. 多级存储系统

为了解决容量、速度、成本的矛盾，计算机系统中往往采用多级存储系统；

Register -> Cache -> 内存 -> 硬盘；

## II. 半导体随机存储器(RAM)

### 1. 半导体存储芯片

![image-20210418005303171](C:\Users\dzw\AppData\Roaming\Typora\typora-user-images\image-20210418005303171.png)

### 2. SRAM和DRAM

存储器的最基本构件是存储元，用来存放一个二进制位；

地址码相同的存储元构成一个存储单元；

若干存储单元构成一个存储体；

**SRAM工作原理**

SRAM的存储元使用双稳态触发器来记忆信息；

信息被读出后，可以保持原信息不变，但只要一断电，保存的信息便会丢失；

集成度低，功耗大，常用于制作Cache；

**DRAM工作原理**

DRAM的存储元利用栅极电容上的电荷存储信息；

一般该电荷只能维持1~2ms，因此需要不断的刷新，才能保持信息不丢失；

常见的刷新方式有：

（1）集中刷新

​	在一个刷新周期内，取一段固定的时间，对所有单元进行刷新，在此期间存储器不能被访问（即死区）；

​	速度快，但死区内无法访问；

（2）分散刷新

​	把对每行的刷新分散至各个工作周期内；

​	速度慢，但没有死区；

（3）异步刷新

​	结合前两种方法，在减少死区的同时，提高速度；

## III. 只读存储器ROM

### 1. 特点

（1）结构简单，位密度可以比RAM更高；

（2）非易失，可靠性高；

### 2. 类型

按照制造工艺，可以分为：

（1）掩膜式只读存储器MROM

​	MROM的内容由厂商在出厂时写入，无法更改；

​	价格便宜，可靠性高，但不灵活；

（2）一次可编程只读存储器PROM

​	允许用户改写内容一次；

（3）可擦除可编程只读存储器EPROM

​	内容可以多次改写，但次数有限，且写入速度慢；

​	按照擦除技术，可以分为：

​		紫外线擦除UVEPROM；

​		电擦除EEPROM；

（4）闪速存储器Flash Memory

​	基于EEPROM改进，电擦除的重写速度快；

（5）固态硬盘SSD

​	使用固态电子存储芯片阵列制成，由控制单元和存储单元组成；

​	价格高，读写速度快，功耗低；

## IV. 内存与CPU的连接

### 1. 连接原理

![image-20210418152153202](C:\Users\dzw\AppData\Roaming\Typora\typora-user-images\image-20210418152153202.png)

数据总线：位数与工作频率的乘积，正比于数据传输率；

控制总线：指出总线周期的类型，和本次IO完成的时间；

地址总线：位数决定了可寻址的最大内存空间；

### 2. 内存容量的拓展

单个存储芯片的容量有限，需要在字长和位数两方面进行扩充才能满足内存的容量需求；

拓展方法：

（1）位拓展法；

（2）字拓展法；

（3）字位同时拓展法；

### 3. 片选方式

通过片选信号选择对应的存储芯片，根据片选信号产生方式的不同，可分为：

（1）线选法

​	使用一部分地址线直接连接至内存的片选端，当某位信号为0时，则便是选择对应的存储芯片；

​	优点：不需要地址译码器，线路简单；

​	缺点：不能充分利用存储器空间，造成地址资源的浪费；

（2）译码片选法

​	使用地址译码器；

## V. 双端口RAM与多模块存储器

为提高CPU访问存储器的速度，可以采用双模块RAM（空间并行）和多模块存储器（时间并行）等技术；

### 1. 双端口RAM

指同一个存储器有左、右两个独立的端口，分别具有两组独立的地址、数据、控制线，允许两个CPU异步地进行访问；

其中会存在四种情况：

①两个端口不同时对同一地址存取；（无冲突）

②两个端口同时读同一地址；（无冲突）

③两个端口同时写同一地址；（有冲突）

④两个端口对同一地址，一个读，一个写；（有冲突）

解决方法：设置BUSY信号，当BUSY时，暂时使一个端口不可用；

### 2. 多模块存储器

CPU的速度远快于存储器，因此一次从存储器中取出多条指令更能有效利用CPU资源，基于此设计了多模块存储器；

（1）单体多字存储器；

（2）多体并行存储器；

## VI. 高速缓冲存储器

### 1. 程序访问的局部性原理

程序访问具有时间局部性和空间局部性；

时间局部性：

在最近的未来要用到的信息，很可能是现在正在使用的信息；

空间局部性：

在最近的未来要用到的信息，很可能与现在正在使用的信息在存储空间上是相邻的；

基于该原理，把程序中正在使用的大部分放在一个高速的、较小的存储空间中，让CPU直接访问，从而大大提升运行速度，由此形成了Cache；

### 2. Cache的工作原理

Cache和内存被分为若干大小相等的块，称为Cache块；

Cache根据某种策略，预测CPU即将要使用的数据，将其预装进Cache中；

当CPU请求时，若数据在Cache中则直接返回；若找不到数据，再访问内存，并替换Cache块中的数据；

CPU和Cache之间数据交换以“字”为单位，Cache和内存之间数据交换以“Cache块”为单位；

Cache的命中率即数据在Cache中的次数与总请求次数的比例；

### 3. Cache与内存的映射方式

（1）直接映射；

（2）全相联映射；

（3）组相联映射；

### 4. 内存块替换方法

（1）随机算法；

（2）先进先出算法；

（3）近期最少使用算法；

（4）最不经常使用算法；

### 5. Cache写策略

对于写命中：

（1）全写法；

（2）写回法；

对于写不命中：

（1）写分配法；

（2）非写分配法； 

## VII. 虚拟存储器

内存与硬盘共同构成虚拟存储器，形成一个庞大的地址空间，在该空间内，用户可以自由编程，而不必在意实际的内存容量和位置；

用户允许涉及的地址称为**虚地址**；

实际的内存单元地址称为**实地址**；

CPU使用虚地址时，需要辅助硬件找出对应的实地址，如该地址位于内存中，则直接取用；如不在，则将包含该地址的一页或一段调入内存中供CPU访问；

### 1. 页式虚拟存储器

以页为基本单位的虚拟存储器；

内存空间与虚拟空间被分为相同大小的页，分别为实页与虚页；

虚拟地址 = 虚页号 + 页内地址；

**页表**长期存放在内存中，记录了当虚页被调入内存中时对应的位置；

**页表项地址**记录每个虚页对应的虚页号、实页号、装入位等信息；

**装入页**为“1”时，表示该页已被载入到内存中；为“0”时，需要启动IO系统将该页从硬盘载入到内存中；

缺点：程序不是页的整数倍，会造成浪费；

优点：页的长度固定，调入方便；

### 2. 段式虚拟存储器

以段为单位，段按程序的逻辑结构划分，长度因程序而异；

虚拟地址 = 段号 + 段内地址；

**段表**长期存放在内存中，记录段号，段起点，装入位，段长等信息；

优点：段的分界与程序的分界对应，避免了浪费，具有逻辑独立性；

缺点：因为段的长度可变，不易分配空间，容易留下碎片；

### 3. 段页式虚拟存储器

把程序按逻辑结构分段，再划分为固定大小的页；

优点：兼具页式与段式虚拟存储器的优点；

缺点：需要执行两次查表操作，时间开销较大；

### 4. 快表TLB

依据程序执行的局部性原理，将对应的页表放入高速缓冲器组成的快表TLB中，从而显著提升效率；

相应的把内存中的页表称为慢表Page，快表只存放了慢表中很少的一部分；

查找时，快表与慢表同时进行，若在快表中找到，则停止在慢表中的查找；

查询顺序为：TLB -> 页表 -> Cache -> 内存；

# 四、指令系统

## I. 指令格式

指令是计算机运行的**最小功能单位**；

所有指令的集合构成了指令系统，也称**指令集**；

指令 = 操作码字段 + 地址码字段；

​	操作码字段：指出该指令应该执行什么性质的操作和具有什么样的功能；

​	地址码字段：参与该操作的数据的地址；

### 1. 格式分类

（1）根据指令的长度与机器字长的关系

​	指令的长度指一条指令中包含的二进制代码的位数，指令的长度与机器字长并没有固定关系，但根据其与机器字长的比例，可以分为**单字长指令**、**半字长指令**和**双字长指令**等；

（2）根据指令的长度是否变化

​	若每条指令长度相同，则为**定长指令字结构**，其执行快，操作简单；若指令的长度因功能而异，则为**不定长指令字结构**（其长度仍为机器字长的整数倍）；

（3）根据操作码和地址码数目的不同

​	①**零地址指令**

​		指只有操作码，而没有地址码；

​	②**多地址指令**

## II. 寻址方式

### 1. 指令寻址

​	指寻找下一条将要执行的指令的地址；

​	分为顺序指令寻址和跳跃数据寻址；

​	**（1）顺序指令寻址**

​		通过程序计数器（PC）加1，得到下一条指令的地址；

​	**（2）跳跃数据寻址**

​		本条指令修改程序计数器（PC）的值，从而跳跃到下一条指令；

### 2. 数据寻址

​	指寻找操作数的地址；

​	![image-20210425230143319](C:\Users\dzw\AppData\Roaming\Typora\typora-user-images\image-20210425230143319.png)

​	10种常用方式有：

​	**（1）隐含寻址**

​		形式地址A不给出操作数的地址，而是存放在计算机某个硬件中；

​		如ADD指令的操作数隐含在累加器（ACC）中；

​	**（2）立即寻址**

​		形式地址A中存放的不是操作数的地址，而是操作数本身；

​	（3）直接寻址

​		形式地址A中存放操作数的真实地址；

​	（4）间接寻址

​		通过形式地址A得到操作数的真实地址，再由真实地址得到操作数；

​		可以是一次间接寻址，也可以是多次间接寻址；

​	（5）寄存器寻址

​		形式地址A中给出寄存器编号，对应寄存器中存放操作数；

​	（6）寄存器间接寻址

​		形式地址A中给出的寄存器里存放操作数的地址；

​	（7）相对寻址

​		形式地址A + 程序计数器PC = 操作数的地址；

​	（8）基址寻址

​		形式地址A + 基址寄存器BR = 操作数的地址；

​	（9）变址寻址

​		形式地址A + 变址寄存器IX = 操作数的地址；

​	（10）堆栈寻址

​		操作数存放在堆栈中,隐含使用堆栈指针（SP）作为操作数地址；

|                | 优点                                   | 缺点                          |
| -------------- | -------------------------------------- | ----------------------------- |
| 隐含寻址       | 缩短指令长度                           | 需要额外的地方存放操作数      |
| 立即寻址       | 不用访问内存即可获得数据，速度最快     | A的位数限制了操作数的范围     |
| 直接寻址       | 简单，只需要访问一次内存               | A的位数限制了操作数的寻址范围 |
| 间接地址       | 扩大寻址范围                           | 需要访问多次内存，速度慢      |
| 寄存器寻址     | 不访问内存只访问寄存器，指令短且速度快 | 寄存器资源珍惜                |
| 寄存器间接寻址 | 相比一般的间接寻址速度更快             | 寄存器资源珍惜                |
| 相对寻址       | 操作数的地址不固定                     |                               |
| 基址寻址       | 扩大了寻址范围                         |                               |
| 变址寻址       | 扩大了寻址范围                         |                               |
| 堆栈寻址       | 隐含使用了SP指针，指令短               |                               |

## III. CISC与RISC

### 1. 复杂指令系统计算机CISC

特点：

1. 指令系统复杂庞大，指令数目多大数百条；
2. 指令的长度不固定；
3. 可以访存的指令不受限制；
4. 各种指令的使用频率相差很大；
5. 各种指令的执行时间相差很大；
6. 控制器大多采用微程序控制；
7. 难以优化生成高效的程序。

### 2. 精简指令系统计算机RISC

特点：

1. 选取使用频率最高的一部分指令作为简单指令，其他的指令由简单指令的组合构成；
2. 指令长度固定；
3. 只有Load/Store指令访问内存，其他指令均在寄存器之间进行；
4. CPU中通用寄存器的数量多；
5. 采用指令流水线技术，大多数指令在一个时钟周期内完成；
6. 以硬布线控制为主，很少使用微程序；
7. 重视编译优化工作。

### 3. CISC与RISC的比较

相比于CISC，RISC有以下优点：

（1）更能充分利用芯片的面积（微程序少）；

（2）运算速度更快；

（3）便于设计；

（4）利于程序的优化。

   

# 五、中央处理器CPU

## I. 功能与结构

### 1. 功能

​	具体功能有：

​	（1）指令控制

​		获取指令，分析指令，执行指令；

​	（2）操作控制

​		将操作信号发往对应的部件，从而控制这些部件完成操作；

​	（3）时间控制

​		为每条指令按时间顺序提供操作信号；

​	（4）数据加工

​		算术与逻辑运算；

​	（5）中断处理

​		对异常情况与特殊请求进行处理；

### 2. 结构

![image-20210427011824665](C:\Users\dzw\AppData\Roaming\Typora\typora-user-images\image-20210427011824665.png)

​	CPU内部寄存器可分为两类：

​	（1）用户可见的寄存器

​		如通用寄存器，程序状态字寄存器，可以进行编程；

​	（2）用户不可见的寄存器

​		如MDR，MAR，指令寄存器等；

## II. 指令执行过程

### 1. 指令周期

CPU从内存中取出并执行一条指令所需的全部时间称为指令周期；

指令周期 = n个机器周期；机器周期 = n个时钟周期；

![image-20210427015006606](C:\Users\dzw\AppData\Roaming\Typora\typora-user-images\image-20210427015006606.png)

### 2. 数据流

数据流指根据指令要求依次访问的数据序列；

（1）取指周期

​	从内存中取出指令代码，存放在指令寄存器IR中；

（2）间址周期

​	取操作数的有效地址；

（3）执行周期

​	根据指令寄存器IR中的指令的操作码和操作数通过ALU产生执行结果；

（4）中断周期

​	请求中断请求。

### 3. 执行方案

（1）单指令周期

​	指令之间串行执行；

​	所有指令都选用相同的执行时间来完成，指令周期取决于执行时间最长的指令；

​	缺点：降低了整个系统的执行速度；

（2）多指令周期

​	指令之间串行执行；

​	指令需要几个周期就为其分配几个周期；

（3）流水线方案

​	指令之间并行执行；

​	每个时钟周期启动一条指令，尽量让多条指令同时执行，且各自处于不同的步骤中；

## III. 数据通路

### 1. 功能

​	实现了CPU内部的运算器和各个寄存器之间的数据交换；

### 2. 结构

（1）CPU内部单总线方式

​	所有寄存器的输入端和输出端都连接到一条公共通路上；

​	优点：结构简单；

​	缺点：数据传输存在较多的冲突，性能低下；

（2）CPU内部多总线方式

​	将单总线拓展到多条总线，提高了数据传输的效率；

（3）专用数据通路方式

​	根据数据和地址的流动方向安排专用线路，避免共享总线；

​	优点：性能高；

​	缺点：硬件量大，线路复杂，成本高；

## IV. 控制器

### 1. 功能

①从内存中取指令，并指出下一条指令的地址；

②对指令进行译码，产生控制信号，启动相应的动作；

③指挥并控制各部件之间的数据流动。

### 2. 硬布线与微程序控制器

|          | 硬布线                                                       | 微程序                                                       |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 工作原理 | 微操作控制信号由组合逻辑电路根据当前的指令码、状态和时序，即时生成 | 微操作控制信号以微程序的形式存放在控制存储器中，执行指令时读出即可 |
| 执行速度 | 快                                                           | 慢                                                           |
| 规整性   | 繁琐，不规整                                                 | 较为规整                                                     |
| 拓展性   | 困难                                                         | 容易拓展修改                                                 |
| 应用场景 | RISC的CPU                                                    | CISC的CPU                                                    |

## V. 指令流水线

计算机中普遍采用的一种并行处理技术，将一个重复的过程分解为若干个子过程，每个子过程与其他子过程并行执行；只需要增加少量的硬件，就可以将计算机的运算速度大大提高。 

### 1. 特点

相比传统的串行执行，流水线具有以下特点：

1. 把一个任务分解为多个子任务，每个子任务由一个专门的功能部件来执行，依靠多个功能部件并行工作来缩短任务的执行时间；
2. 每个功能部件后面都要有一个缓冲寄存器（锁存器），用来保存本次流水段的执行结果，以供下一流水段使用；
3. 流水线中各个功能段的时间应尽量相等，否则会引起堵塞、断流；
4. 只有重复、连续的任务，才能发挥流水线的效率；
5. 流水线需要装入时间和排空时间，即第一个任务和最后一个任务所需的时间；

### 2. 分类

根据流水线使用级别的不同：

​	部件功能级流水线；

​	处理机级流水线；

​	处理机间级流水线；

根据可以完成的功能：

​	单功能流水线 - 只能实现一种固定的功能；

​	多功能流水线 - 通过各段间的不同连接方式可以实现多种不同功能；

根据段间的连接方式：

​	静态流水线 - 各段只能按同一种功能的连接方式工作；

​	动态流水线 - 某些段在实现某种功能的同时，另一些段能同时实现另一种功能；

根据是否有反馈回路：

​	线性流水线 - 从输入到输出，各段只经过一次，不存在反馈回路；

​	非线性流水线 - 存在反馈回路，适合递归运算；

### 3. 影响因素

（1）结构相关 - 资源冲突

​		原因：多条指令同一时刻争用同一资源，产生资源冲突；

​		解决方法：①使后一条会产生冲突的指令延迟一个时钟周期；

​						   ②为两条指令配置各自单独的存储器；

（2）数据相关 - 数据冲突

​		原因：在一个程序内，存在必须等前一条指令执行完才能执行下一条指令的情况；

​		解决方法：①延迟执行；

​						   ②使用数据旁路技术，增加专用通路；

​						   ③编译优化，调整指令顺序；

（3）控制相关 - 控制冲突

​		原因：流水线遇到转移指令等改变PC值的指令，而造成断流；

​		解决方法：对转移指令进行分支预测，加快和提前生成目标地址；

### 4. 性能指标

（1）吞吐率

​		吞吐率 = 单位时间内完成的任务数量；

（2）加速比

​		完成同一批任务，不使用流水线所用时间和使用流水线后的所用时间之比；

（3）效率

​		即流水线的设备利用率；

### 5. 超标量流水线

# 六、总线

## I. 概述

### 1. 基本概念

|          | 总线                                                         |
| -------- | ------------------------------------------------------------ |
| 定义     | 一组能为多个部件分时共享的公共信息传送线路                   |
| 特点     | **分时**：同一时刻只允许一个部件向总线发送信息               |
|          | **共享**：允许挂接多个部件，多个部件可同时从总线上接收相同的信息 |
| 设备     | 主设备：获取总线控制权的设备                                 |
|          | 从设备：被主设备访问的设备，只想被动响应而不能主动访问       |
| 传输方式 | 在一个总线周期内，传输存储地址连续的多个数据字的传输方式，称为**猝发传送** |

### 2. 分类

按功能分为：

（1）片内总线

​	CPU内部的总线，连接CPU内部的寄存器与寄存器、寄存器与ALU的公共连接线；

（2）系统总线

​	计算机系统内，CPU、内存、IO接口之间相互连接的总线；

​	可细分为数据总线、地址总线、控制总线；

（3）通信总线

​	计算机与计算机之间通信所用的总线，也叫外部总线；

### 3. 结构

|            | 特点                                                         | 优点                   | 缺点                           |
| ---------- | ------------------------------------------------------------ | ---------------------- | ------------------------------ |
| 单总线结构 | 将CPU、内存、IO设备都挂接在一组总线上，三者之间可以直接进行信息交换 | 简单，成本低，易于拓展 | 带宽低，负载重，不支持并发传送 |
| 双总线结构 | 一条内存总线，连接CPU和内存；<br />一条IO总线，用于连接各个IO设备；<br />两条总线之间通过通道连接 | 将低速的IO设备分离出去 | 需要增加通道等硬件设备         |
| 三总线结构 | 分为内存总线、IO总线、直接内存访问总线（DMA）；<br />新增DMA总线连接CPU与高速外设 | 提高了IO设备的性能     | 系统工作效率低                 |

### 4. 性能指标

|          | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 总线周期 | 一次总线操作所需的时间（申请+寻址+传输+结束）                |
| 工作频率 | 总线周期的倒数                                               |
| 总线宽度 | 通常指数据总线的根数                                         |
| 总线带宽 | 单位时间内总线上可传输数据的位数<br />总线带宽 = 工作频率 * (总线宽度 / 8) |
| 总线复用 | 一种信号线传输多种不同的信息                                 |
| 信号线数 | 地址总线、数据总线和控制总线三种总线的根数                   |

## II. 总线仲裁

解决多个主设备同时竞争总线控制权的问题；

### 1. 集中仲裁

将所有的总线请求集中起来，在一个总线控制器内，利用一个特定的仲裁算法进行裁决；

|                | 说明                                                         | 优点             | 缺点                                                         |
| -------------- | ------------------------------------------------------------ | ---------------- | ------------------------------------------------------------ |
| 链式查询       | 总线上的所有部件公用一根总线请求线，通过这一根线发送请求到总线控制器；<br />由总线控制器判断总线是否繁忙；<br />离总线控制器越近的部件，其优先级越高； | 结构简单，易拓展 | 优先级无法改变，优先级高的部件长时间占用总线，导致低优先级部件阻塞<br />需要控制线：$3$根 |
| 计数器定时查询 | 总线上的所有部件公用一组设备地址线；<br />当计数器的计数值与设备地址一致时，该设备获得控制权； | 优先级可以改变   | 增加了控制线的数量<br />需要控制线：$log_2n + 2$根           |
| 独立请求       | 每个部件都有自己独立的总线请求线和总线允许线，发送请求后统一在总线控制器内排队； | 响应速度快       | 增加大量的控制线<br />需要控制线：$2n+1$根                   |

### 2. 分布仲裁

不需要一个总的总线控制器，每个主模块都有自己的仲裁号和仲裁器；

仲裁器之间通过一根仲裁总线共享数据，从仲裁总线上比较优先级不同的仲裁号，优先级高的仲裁器获得总线控制权；

## III. 总线操作和定时

### 1. 传输阶段

申请分配阶段 -> 寻址阶段 -> 传输阶段 -> 结束阶段；

### 2. 同步定时方式

指系统采用一个统一的时钟信号来协调发送和接受双方的传送定时关系；

在一个总线周期内，发送方与接收方完成一次数据传输；

优点：逻辑简单，传输速度快；

缺点：不能及时进行数据传输的有效性校验，可靠性较差；

适用场合：总线长度较短（出错概率低），各部件的存取时间比较接近的系统；

### 3. 异步定时方式

没有统一的时钟，没有固定的时间间隔，完全依靠双方的握手信号实现定时控制；

主设备发出request -> 从设备收到，并发出response -> 主设备收到；

优点：总线周期可变，传输的可靠性有保证；

缺点：速度较慢；

分类：

（1）不互锁方式

​	主设备发出request，一段时间后，撤销request信号；

​	从设备发出response，一段时间后，撤销response信号；

​	两者之间不存在互锁关系；

（2）半互锁方式

​	主设备发出request后，必须等到接收到response后才撤销；

（3）全互锁方式

​	主设备和从设备都必须接收到对应的信号后才撤销；

## IV. 总线标准

**ISA标准**：最早的微型计算机系统总线标准，为IBM开发应用于AT机上，早已淘汰；

**EISA标准**：为配合32位计算机而拓展的ISA标准；

**VESA标准**

**AGP标准**：一种视频接口标准；

**PCI标准**：高性能的32位或64位总线，支持即插即用；

**PCIE标准**：PCI-Express，最新的总线接口标准，将全面替代PCI和AGP总线。

# 七、IO系统

## I. IO控制方式

|                | 工作机制                                                     | 特点                             |
| -------------- | ------------------------------------------------------------ | -------------------------------- |
| 1>程序查询方式 | CPU通过程序不断查询IO设备是否已经做好数据传输准备            | 浪费大量时间查询和等待，效率很低 |
| 2>程序中断方式 | IO设备准备就绪后发出中断请求，CPU接受中断请求后予以响应      |                                  |
| 3>DMA方式      | IO设备可通过DMA控制器向CPU发出DMA请求，CPU响应请求后将总线控制权给DMA控制器，DMA控制器与IO设备通信结束后将总线控制权归还给CPU |                                  |
| 4>通道方式     | 系统中设有专用的通道部件，每个通道挂接若干IO设备，完成IO命令只需要启动对应的通道，通道执行通道程序完成IO操作 |                                  |

2> **程序中断方式**

​	内中断与外中断

​		中断源可以分为内中断和外中断；

​		内中断：在处理器或内存内部产生的中断，如程序运算错误、非法地址；

​		外中断：在处理器或内存以外的部件引起的中断，如用户按键、定时器时钟中断；

​	区分中断源

​		中断系统为每个中断源设置中断请求标记触发器INTR，当标记为1时，表示该中断源有请求；

​	屏蔽中断

​		屏蔽单个：每个中断源都有一个屏蔽触发器，所有屏蔽触发器组合成屏蔽字寄存器；

​		屏蔽全部：中断标志位IF置位时，不接受任何外部可屏蔽中断请求；

​	优先级判定

​		中断优先级判定可以通过硬件排队器实现，也可以通过软件查询程序实现；

​		一般来说，硬件故障中断优先级最高，非屏蔽中断>屏蔽中断，高速设备>低速设备，输入设备>输出设备；

​	中断隐指令

​		CPU从收到中断请求，到执行中断服务程序，之间的步骤由中断隐指令完成；

​		中断隐指令并非真正的系统指令，而是由硬件直接实现，因此叫做隐指令，其不能为用户所使用；

​		中断隐指令完成的操作有：

​			① 关闭中断，执行一个中断的过程中不接收其他中断请求；

​			② 保存断点，即将程序计数器PC保存，以便中断完成后能返回正确的地方；

​			③ 引出中断服务程序，即将中断服务程序的入口地址传给程序计数器PC；

​	中断向量表

​		中断服务程序的入口地址称为中断向量，存放所以中断向量的存储区称为中断向量表；

​	多重中断

​		指CPU在执行中断服务程序的过程中，出现了新的更高优先级的中断，则暂停当前中断，响应新的请求；

3> **DMA请求**

​	DMA的传送过程

​		① 预处理

​			CPU将DMA控制器中的相关寄存器置位，设置传送方向，启动设备，等待IO设备准备好；

​		② 数据传送

​			DMA控制器可以以字为单位、也可以以块为单位进行数据传输；

​			该阶段完全由DMA控制器控制，无需CPU参与；

​		③ 后处理

​			输出传送完成后，DMA控制器向CPU发送中断请求，CPU校验数据正确性

​	DMA的传送方式

​		DMA控制器传送数据时，CPU能够继续运行（虽然总线部分被占用），当两者共同访问一块内存区域时，可能会出现冲突，为解决冲突的方式有：

​			① CPU完全停止访问主存

​				此方法CPU基本处于不工作状态或保持原始状态（那还要DMA干嘛(摔）；

​			② 交替访问内存

​				此方法适用于CPU的工作周期比内存周期长的情况，此时可以将CPU周期划分为两部分；

​				一部分供CPU自己访问，一部分供DMA访问；

​			③ 周期挪用

​				两者任何一方访问内存时，都得先判断对方是否正在访问，必须等对方结束访问后自己再访问；

​				如果两者同时发出访问请求，则一般会让DMA先访问；

​	

## II. 外部设备

### 1. 输入设备

键盘、鼠标；

### 2. 输出设备

（1）显示器

​	按照发光方式可分为：

​	① 阴极射线管显示器（CRT）

​		使用电子枪、偏转线圈、荧光粉涂层不断扫描出现图像；

​	② 液晶显示器（LCD）

​		利用液晶的电光效应，由电压控制液晶分子呈现图像；

​	③ 发光二极管显示器（LED）

​		控制发光二极管显示图像；

（2）打印机

### 3. 外存储器

指辅助存储器，即硬盘；

（1）磁盘存储器（机械硬盘HDD）

​	一块磁盘含有若干记录面（对应磁头数），每个记录面划分为若干磁道（对应柱面数），每个磁道分为若干扇区（扇区数）；

​	扇区（块block）是磁盘读写的最小单位；

​	数据传输率 = 磁盘转速r/s * 每条通道的容量N字节；

​	寻址顺序：驱动器号 -> 柱面号 -> 盘面号 -> 扇区号；

​	机械硬盘的读写是串行的，无法同时读和写，也无法同时读或写两组及以上的数据；

（2）磁盘阵列（RAID）

​	将多个独立的物理磁盘组成一个逻辑盘，数据在多个磁盘上交叉存储，并行访问，牺牲一定容量换取更高的可靠性和性能；

​	RAID0无容错能力，RAID1~5都具有容错能力和数据镜像功能；

（3）光盘

​	类型：CD-ROM - 只读型；

​				CD-R - 只可写入一次；

​				CD-RW - 可重复读写；

​				DVD-ROM - 高容量版的CD-ROM；

（4）固态硬盘（SSD）



## III. IO接口

### 1. 基本结构

<img src="C:\Users\dzw\AppData\Roaming\Typora\typora-user-images\image-20210605100134362.png" alt="image-20210605100134362" style="zoom:80%;" />

内部接口与内存、CPU连接，外部接口与外设连接；

### 2. IO端口

IO端口，指IO接口电路中可以被CPU直接访问的寄存器，分为数据、状态、控制端口；

|          | RW权限   |
| -------- | -------- |
| 数据端口 | 可读可写 |
| 状态端口 | 只读     |
| 控制端口 | 只写     |

每个IO端口都有一个端口地址，才能被CPU访问到，其编址方式有统一编制和独立编址两种；

|                            | 说明                                                         | 优缺点                                                       |
| -------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 统一编址（存储器映射方式） | 把IO端口当作存储器的单元进行地址分配，CPU不需要专门的IO指令，用统一的访存指令就可以访问到IO端口 | 优点：不需要专门的IO指令访问，灵活方便；<br />缺点：占用存储器地址，执行速度较慢； |
| IO编址（IO映射方式）       | 使用专用的指令访问IO端口                                     | 优点：独立指令更为清晰；<br />缺点：需要CPU提供多组指令，增加了复杂性； |

